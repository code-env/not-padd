"var Component=(()=>{var h=Object.create;var o=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,f=Object.prototype.hasOwnProperty;var y=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports),w=(t,n)=>{for(var r in n)o(t,r,{get:n[r],enumerable:!0})},s=(t,n,r,a)=>{if(n&&typeof n==\"object\"||typeof n==\"function\")for(let c of p(n))!f.call(t,c)&&c!==r&&o(t,c,{get:()=>n[c],enumerable:!(a=m(n,c))||a.enumerable});return t};var x=(t,n,r)=>(r=t!=null?h(g(t)):{},s(n||!t||!t.__esModule?o(r,\"default\",{value:t,enumerable:!0}):r,t)),k=t=>s(o({},\"__esModule\",{value:!0}),t);var d=y((I,i)=>{i.exports=_jsx_runtime});var b={};w(b,{default:()=>u});var e=x(d());function l(t){let n={code:\"code\",h1:\"h1\",h2:\"h2\",h3:\"h3\",li:\"li\",ol:\"ol\",p:\"p\",pre:\"pre\",strong:\"strong\",ul:\"ul\",...t.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.h1,{children:\"Transformers\"}),`\n`,(0,e.jsx)(n.p,{children:\"Transform functions allow you to modify documents after parsing, with access to other collections, caching, and conditional skipping.\"}),`\n`,(0,e.jsx)(n.h2,{children:\"Basic Transform\"}),`\n`,(0,e.jsx)(n.p,{children:\"A transform function receives the document and a context object:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ndefineCollection({\n  name: \"posts\",\n  directory: \"content/posts\",\n  schema: z.object({\n    title: z.string(),\n    authorId: z.string(),\n  }),\n  transform: async (doc, context) => {\n    // Modify the document\n    return {\n      ...doc,\n      slug: doc.title.toLowerCase().replace(/\\\\s+/g, \"-\"),\n    };\n  },\n});\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`defineCollection({\n  name: \"posts\",\n  directory: \"content/posts\",\n  schema: z.object({\n    title: z.string(),\n    authorId: z.string(),\n  }),\n  transform: async (doc, context) => {\n    // Modify the document\n    return {\n      ...doc,\n      slug: doc.title.toLowerCase().replace(/\\\\s+/g, \"-\"),\n    };\n  },\n});\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"Context Object\"}),`\n`,(0,e.jsx)(n.p,{children:\"The context provides access to:\"}),`\n`,(0,e.jsx)(n.h3,{children:(0,e.jsx)(n.code,{children:\"documents(collectionName)\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Get all documents from another collection:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ntransform: async (doc, { documents }) => {\n  const authors = documents(\"authors\");\n  const author = authors.find((a) => a.id === doc.authorId);\n\n  return {\n    ...doc,\n    author,\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc, { documents }) => {\n  const authors = documents(\"authors\");\n  const author = authors.find((a) => a.id === doc.authorId);\n\n  return {\n    ...doc,\n    author,\n  };\n},\n`})}),`\n`,(0,e.jsx)(n.h3,{children:(0,e.jsx)(n.code,{children:\"cache(key, ...args, fn)\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Cache expensive operations:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ntransform: async (doc, { cache }) => {\n  const processedContent = await cache(\n    \"process-markdown\",\n    doc.content,\n    async () => {\n      // Expensive operation\n      return await markdownToHtml(doc.content);\n    }\n  );\n\n  return {\n    ...doc,\n    html: processedContent,\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc, { cache }) => {\n  const processedContent = await cache(\n    \"process-markdown\",\n    doc.content,\n    async () => {\n      // Expensive operation\n      return await markdownToHtml(doc.content);\n    }\n  );\n\n  return {\n    ...doc,\n    html: processedContent,\n  };\n},\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"The cache function:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Takes a key and arguments to identify the cache entry\"}),`\n`,(0,e.jsx)(n.li,{children:\"Executes the function only if not cached\"}),`\n`,(0,e.jsx)(n.li,{children:\"Returns cached result if available\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"Works with \",(0,e.jsx)(n.code,{children:'cache: \"file\"'}),\" or \",(0,e.jsx)(n.code,{children:'cache: \"memory\"'}),\" configuration\"]}),`\n`]}),`\n`,(0,e.jsx)(n.h3,{children:(0,e.jsx)(n.code,{children:\"collection\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Access information about the current collection:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:\"```typescript\\ntransform: async (doc, { collection }) => {\\n  console.log(`Processing ${collection.name} in ${collection.directory}`);\\n\\n  // Get all documents in this collection\\n  const allDocs = await collection.documents();\\n\\n  return doc;\\n},\\n```\",children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc, { collection }) => {\n  console.log(\\`Processing \\${collection.name} in \\${collection.directory}\\`);\n\n  // Get all documents in this collection\n  const allDocs = await collection.documents();\n\n  return doc;\n},\n`})}),`\n`,(0,e.jsx)(n.h3,{children:(0,e.jsx)(n.code,{children:\"skip(reason?)\"})}),`\n`,(0,e.jsx)(n.p,{children:\"Conditionally skip documents:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ntransform: async (doc, { skip }) => {\n  if (!doc.published) {\n    return skip(\"Document is not published\");\n  }\n\n  if (doc.draft) {\n    return skip(\"Document is a draft\");\n  }\n\n  return doc;\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc, { skip }) => {\n  if (!doc.published) {\n    return skip(\"Document is not published\");\n  }\n\n  if (doc.draft) {\n    return skip(\"Document is a draft\");\n  }\n\n  return doc;\n},\n`})}),`\n`,(0,e.jsx)(n.p,{children:\"Skipped documents:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"Are not included in the final collection\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"Emit a \",(0,e.jsx)(n.code,{children:\"transformer:document-skipped\"}),\" event\"]}),`\n`,(0,e.jsx)(n.li,{children:\"Can include an optional reason\"}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"Common Patterns\"}),`\n`,(0,e.jsx)(n.h3,{children:\"Resolving References\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ntransform: async (doc, { documents }) => {\n  const categories = documents(\"categories\");\n  const authors = documents(\"authors\");\n\n  return {\n    ...doc,\n    category: categories.find((c) => c.id === doc.categoryId),\n    author: authors.find((a) => a.id === doc.authorId),\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc, { documents }) => {\n  const categories = documents(\"categories\");\n  const authors = documents(\"authors\");\n\n  return {\n    ...doc,\n    category: categories.find((c) => c.id === doc.categoryId),\n    author: authors.find((a) => a.id === doc.authorId),\n  };\n},\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"Computing Derived Fields\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ntransform: async (doc) => {\n  const words = doc.content.split(/\\\\s+/).length;\n  const readingTime = Math.ceil(words / 200); // 200 words per minute\n\n  return {\n    ...doc,\n    wordCount: words,\n    readingTime,\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc) => {\n  const words = doc.content.split(/\\\\s+/).length;\n  const readingTime = Math.ceil(words / 200); // 200 words per minute\n\n  return {\n    ...doc,\n    wordCount: words,\n    readingTime,\n  };\n},\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"Processing Content\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\nimport { remark } from \"remark\";\nimport remarkHtml from \"remark-html\";\n\ntransform: async (doc, { cache }) => {\n  const html = await cache(\n    \"markdown-to-html\",\n    doc.content,\n    async () => {\n      const result = await remark()\n        .use(remarkHtml)\n        .process(doc.content);\n      return result.toString();\n    }\n  );\n\n  return {\n    ...doc,\n    html,\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`import { remark } from \"remark\";\nimport remarkHtml from \"remark-html\";\n\ntransform: async (doc, { cache }) => {\n  const html = await cache(\n    \"markdown-to-html\",\n    doc.content,\n    async () => {\n      const result = await remark()\n        .use(remarkHtml)\n        .process(doc.content);\n      return result.toString();\n    }\n  );\n\n  return {\n    ...doc,\n    html,\n  };\n},\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"Filtering Documents\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ntransform: async (doc, { skip }) => {\n  // Only include published posts\n  if (!doc.published) {\n    return skip(\"Not published\");\n  }\n\n  // Exclude future-dated posts\n  if (new Date(doc.date) > new Date()) {\n    return skip(\"Scheduled for future\");\n  }\n\n  return doc;\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc, { skip }) => {\n  // Only include published posts\n  if (!doc.published) {\n    return skip(\"Not published\");\n  }\n\n  // Exclude future-dated posts\n  if (new Date(doc.date) > new Date()) {\n    return skip(\"Scheduled for future\");\n  }\n\n  return doc;\n},\n`})}),`\n`,(0,e.jsx)(n.h3,{children:\"Sorting and Ordering\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\ntransform: async (doc, { collection }) => {\n  const allDocs = await collection.documents();\n\n  // Add index based on date\n  const sorted = allDocs.sort((a, b) =>\n    new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n  const index = sorted.findIndex((d) => d._meta.path === doc._meta.path);\n\n  return {\n    ...doc,\n    index,\n    prev: index > 0 ? sorted[index - 1] : null,\n    next: index < sorted.length - 1 ? sorted[index + 1] : null,\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`transform: async (doc, { collection }) => {\n  const allDocs = await collection.documents();\n\n  // Add index based on date\n  const sorted = allDocs.sort((a, b) =>\n    new Date(b.date).getTime() - new Date(a.date).getTime()\n  );\n  const index = sorted.findIndex((d) => d._meta.path === doc._meta.path);\n\n  return {\n    ...doc,\n    index,\n    prev: index > 0 ? sorted[index - 1] : null,\n    next: index < sorted.length - 1 ? sorted[index + 1] : null,\n  };\n},\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"Return Types\"}),`\n`,(0,e.jsx)(n.p,{children:\"Transform functions must return:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsx)(n.li,{children:\"The transformed document (same structure as input, but can add/modify fields)\"}),`\n`,(0,e.jsxs)(n.li,{children:[\"A \",(0,e.jsx)(n.code,{children:\"skip()\"}),\" signal to exclude the document\"]}),`\n`,(0,e.jsx)(n.li,{children:\"A serializable object (no functions, classes, or circular references)\"}),`\n`]}),`\n`,(0,e.jsx)(n.h3,{children:\"Serialization Rules\"}),`\n`,(0,e.jsx)(n.p,{children:\"The return value must be serializable:\"}),`\n`,(0,e.jsxs)(n.ul,{children:[`\n`,(0,e.jsxs)(n.li,{children:[\"\\u2705 Primitives: \",(0,e.jsx)(n.code,{children:\"string\"}),\", \",(0,e.jsx)(n.code,{children:\"number\"}),\", \",(0,e.jsx)(n.code,{children:\"boolean\"}),\", \",(0,e.jsx)(n.code,{children:\"null\"}),\", \",(0,e.jsx)(n.code,{children:\"undefined\"})]}),`\n`,(0,e.jsx)(n.li,{children:\"\\u2705 Objects and arrays\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u2705 Dates (serialized as ISO strings)\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u2705 Maps and Sets (serialized as objects/arrays)\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u2705 BigInt (serialized as strings)\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u274C Functions\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u274C Classes\"}),`\n`,(0,e.jsx)(n.li,{children:\"\\u274C Circular references\"}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"Imports\"}),`\n`,(0,e.jsx)(n.p,{children:\"You can return import references that will be resolved at build time:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\nimport { createDefaultImport, createNamedImport } from \"notpadd-core\";\n\ntransform: async (doc) => {\n  return {\n    ...doc,\n    // Import default export\n    component: createDefaultImport(\"./components/Post.tsx\"),\n\n    // Import named export\n    utils: createNamedImport(\"formatDate\", \"./utils.ts\"),\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`import { createDefaultImport, createNamedImport } from \"notpadd-core\";\n\ntransform: async (doc) => {\n  return {\n    ...doc,\n    // Import default export\n    component: createDefaultImport(\"./components/Post.tsx\"),\n\n    // Import named export\n    utils: createNamedImport(\"formatDate\", \"./utils.ts\"),\n  };\n},\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"Error Handling\"}),`\n`,(0,e.jsx)(n.p,{children:\"Errors in transform functions are caught and emitted as events:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\n// Errors are automatically caught and emitted\ntransform: async (doc) => {\n  // If this throws, it's caught and emitted as transformer:error\n  const result = await someAsyncOperation(doc);\n  return result;\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`// Errors are automatically caught and emitted\ntransform: async (doc) => {\n  // If this throws, it's caught and emitted as transformer:error\n  const result = await someAsyncOperation(doc);\n  return result;\n},\n`})}),`\n`,(0,e.jsx)(n.h2,{children:\"Performance Considerations\"}),`\n`,(0,e.jsxs)(n.ol,{children:[`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Use caching\"}),\": Cache expensive operations like markdown processing\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Avoid unnecessary work\"}),\": Skip documents early if possible\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Batch operations\"}),\": Process multiple documents together when possible\"]}),`\n`,(0,e.jsxs)(n.li,{children:[(0,e.jsx)(n.strong,{children:\"Leverage parallel execution\"}),\": Transforms run in parallel per collection\"]}),`\n`]}),`\n`,(0,e.jsx)(n.h2,{children:\"Type Safety\"}),`\n`,(0,e.jsx)(n.p,{children:\"Transform functions are fully typed based on your schema:\"}),`\n`,(0,e.jsx)(n.pre,{language:\"typescript\",meta:\"\",code:`\\`\\`\\`typescript\n// doc is typed as Schema<\"frontmatter\", YourSchema> & { _meta: Meta }\ntransform: async (doc, context) => {\n  // TypeScript knows doc.title exists\n  const title = doc.title;\n\n  // Return type is inferred from what you return\n  return {\n    ...doc,\n    slug: title.toLowerCase(),\n  };\n},\n\\`\\`\\``,children:(0,e.jsx)(n.code,{className:\"language-typescript\",children:`// doc is typed as Schema<\"frontmatter\", YourSchema> & { _meta: Meta }\ntransform: async (doc, context) => {\n  // TypeScript knows doc.title exists\n  const title = doc.title;\n\n  // Return type is inferred from what you return\n  return {\n    ...doc,\n    slug: title.toLowerCase(),\n  };\n},\n`})})]})}function u(t={}){let{wrapper:n}=t.components||{};return n?(0,e.jsx)(n,{...t,children:(0,e.jsx)(l,{...t})}):l(t)}return k(b);})();\n;return Component;"